<!DOCTYPE html>
<html>
  <head>
    <script src="aframe-master.min.js"></script>
    <script src="aframe-network-component.js"></script>
    <script>
      AFRAME.registerComponent("look-at", {schema: {type: "selector"}, init: function () {}, tick: function () {this.el.object3D.lookAt(this.data.object3D.position);}});
    </script>
  </head>
  <body>
    <audio id="audioOn" src="click_on.wav"></audio>
    <audio id="audioOff" src="click_off.wav"></audio>
    <a-scene background="color: #FFFFFF;">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 5;" position="0.0 1.6 0.0"></a-entity>
      <a-entity light="type: ambient;"></a-entity>
      <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="rightController" hand-controls="hand: right; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelColor: #7F7F7F;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelColor: #7F7F7F"></a-entity>
      <a-circle position="0.0 0.0 0.0" radius="2.200000" rotation="-90 0 0" color="#F0F0F0"></a-circle>
      <a-network position="0.0 0.0 0.0" rotation="0 0 0" node_size="0.020000" edge_opacity="0.2" src="url(cytokine.ply)"></a-network>
    </a-scene>
    <script>
      const node_names = ["CLCF1","IFNA2","PDGFD","CXCL12","CCL8","CXCL11","BMP4","CCL7","IL33","CCL4","CCL3","CCL27","EPO","CCL26","CCL5","CCL24","CD40LG","CCL21","CCL22","BMP6","CCL20","CCL2","IFNA","IFNL1","IL4","BMP2","TSLP","CCL23","TNFSF9","TNFSF13B","THPO","TNF","MSTN","HMGB1","CCL19","LTA","TGFB2","TGFB1","IL17A","TGFA","IL36RN","RETN","PPBP","PDGFB","INS","NO","IL18","PDGFA","GDF11","TNFSF10","OSM","MIF","LIF","IL25","IGF1","KITLG","Activin A","PGE2","IL9","CXCL8","IL7","IL21","CD40L","IL6","TNFSF11","IL37","IL32","IL13","CSF2","IL27","WNT3A","IL20","IL1B","FGF10","GDNF","IL1A","IL12","IL17F","CCL11","IL15","CCL1","IFNB","IL12A","IL11","BDNF","TGFB3","HGF","TNFSF12","GDF15","CSF3","FGF2","IL5","BMP7","FGF1","EGF","IL2","CXCL5","IL1RN","IL22","IL3","CXCL3","IL16","CXCL2","PF4","NRG1","CXCL13","IL10","CXCL10","IFNG","CXCL1","CCL18","IFNB1","VEGFA","IL12B","CX3CL1","CXCL9","CSF1","SPP1"];
      const node_positions = [0.417272,0.475869,-2.045345,0.681749,1.708612,-2.064135,0.856556,1.165728,-1.775040,0.610032,1.762786,-2.004751,-0.900746,1.278188,-1.934756,-0.758405,1.508613,-1.842376,0.276280,1.952179,-1.950235,-0.859541,1.155450,-1.787924,0.596044,1.176474,-1.914961,-0.940755,0.809846,-1.970813,-0.213225,0.023446,-2.175266,-0.851751,1.093037,-1.755723,0.812067,1.541872,-2.013227,0.470532,1.479146,-2.071631,-0.138064,1.988079,-1.960484,-0.812166,1.453469,-1.898375,0.364457,1.931019,-2.153869,-0.692054,0.359874,-1.905483,-0.327019,1.941129,-2.117763,-0.383793,0.081540,-2.118750,0.076210,0.319591,-2.166010,0.673223,0.364138,-1.831733,-0.955545,0.967357,-1.961041,0.470346,1.877719,-2.109402,-0.305771,0.399940,-2.042341,0.507924,1.370759,-1.888935,0.466981,0.136763,-1.985602,-0.512946,1.827234,-1.970391,-0.823392,0.571373,-1.895510,-0.080837,0.003877,-1.961154,0.031683,1.683831,-2.056377,-0.588600,0.687436,-2.080509,0.561685,1.810556,-2.047792,0.893466,0.674805,-1.942103,-0.086271,1.996047,-2.066840,0.654468,1.018025,-2.028039,0.124276,0.329288,-1.960723,0.255355,0.370633,-2.057504,0.851721,0.734902,-1.810956,0.192519,0.351693,-2.023883,-0.682497,1.661154,-1.928130,0.298577,0.057243,-1.932056,-0.922251,1.030257,-1.892546,-0.752269,1.612662,-2.008220,-0.164928,1.987233,-2.018998,-0.817990,0.629027,-1.825680,0.601937,1.092121,-1.882773,0.910835,1.227401,-1.914943,0.810712,1.432102,-1.858784,-0.305633,0.058428,-1.987168,0.388368,0.437817,-2.150929,-0.270081,1.960533,-2.129909,-0.536201,0.209166,-1.882914,-0.855979,0.748500,-1.822730,-0.038660,1.683201,-2.096369,0.146524,1.668402,-2.141763,0.536027,0.624984,-2.003563,-0.853275,1.217248,-1.799375,-0.631129,1.707033,-1.900374,0.674260,0.955400,-2.093335,-0.867668,0.888250,-1.792533,0.171062,1.983232,-2.002256,-0.442593,1.468300,-1.926314,0.790626,1.487951,-1.879820,-0.538261,0.172222,-2.070908,-0.415151,0.492859,-1.968307,0.297661,1.600550,-1.963411,0.880792,1.103400,-1.807469,-0.181490,1.657332,-2.111048,-0.027265,0.000000,-2.144008,-0.488741,0.138549,-2.086046,-0.815438,0.515414,-1.946347,-0.157212,0.336843,-2.064131,0.733665,1.593651,-1.907539,0.045431,1.999438,-2.064453,-0.685720,0.312824,-2.005867,0.125178,1.992902,-2.192411,0.672954,1.643084,-1.846476,-0.698901,0.409455,-1.823686,-0.903353,0.688147,-1.964577,-0.204970,1.976170,-2.054091,-0.759342,0.461370,-1.889540,0.032882,0.000064,-2.071213,0.261514,0.038063,-2.062915,0.416693,1.906160,-2.122168,0.003038,0.315478,-2.120871,0.408163,0.106690,-1.954493,0.936424,0.796048,-1.956872,-0.804652,1.561748,-2.042980,-0.608143,0.923545,-1.911044,0.737430,0.425853,-1.881513,0.883372,0.615993,-1.972595,0.140187,0.020437,-1.978567,-0.406815,0.108282,-1.955837,0.479889,0.564941,-1.949710,-0.146633,0.011694,-2.104468,-0.399100,1.891284,-1.914755,-0.818598,1.338028,-1.799569,0.379265,0.080149,-2.084774,0.606551,0.818622,-1.952899,0.455656,0.518310,-2.016903,0.587018,1.247152,-1.957972,0.763162,0.478473,-1.860837,0.924870,0.857999,-1.908427,0.514269,1.845809,-2.065439,-0.077683,0.320796,-2.065175,-0.628409,1.106365,-1.987309,-0.626256,1.750118,-2.025834,0.220686,1.969629,-1.941184,0.576702,0.689291,-2.017961,-0.380051,1.918035,-2.092360,-0.490531,1.860960,-2.089909,0.855441,1.288175,-1.833193,-0.026758,2.000000,-2.029759,-0.552677,1.790237,-1.938061,-0.865398,1.396532,-1.956708,-0.264734,0.039038,-2.099888,0.401177,1.521911,-1.954353];
      function toggle_label(index, labels, positions) {
        var existing = document.getElementById("label"+index);
        if (existing) {
          document.getElementById("audioOff").play();
          existing.parentElement.removeChild(existing);
        }
        else {
          document.getElementById("audioOn").play();
          var entity = document.createElement("a-entity");
          entity.setAttribute("id", "label"+index);
          entity.setAttribute("look-at", "#camera");
          entity.setAttribute("position", {x: positions[index*3], y: positions[index*3+1], z: positions[index*3+2]});
          entity.setAttribute("scale", {x: 0.200000, y: 0.200000, z: 0.200000});
          entity.setAttribute("text", {anchor: "left", baseline: "bottom", color: "#000000", value: labels[index]});
          document.querySelector("a-scene").appendChild(entity);
        }
      }
      function find_nearest(position, positions) {
        var nearest_d = 1000.0;
        var nearest_i = null;
        for (let i = 0; i < node_positions.length; i += 3) {
          let d = Math.sqrt((position.x-positions[i])**2+(position.y-positions[i+1])**2+(position.z-positions[i+2])**2);
          if (d < nearest_d) {
            nearest_d = d;
            nearest_i = i/3;
          }
        }
        if (nearest_d < 0.1) {
          toggle_label(nearest_i, node_names, positions);
        }
      }
      document.getElementById("leftController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("leftController").getAttribute("position"), node_positions);
      });
      document.getElementById("rightController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("rightController").getAttribute("position"), node_positions);
      });
      document.getElementById("leftHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
      document.getElementById("rightHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
    </script>
  </body>
</html>
