<!DOCTYPE html>
<html>
  <head>
    <script src="aframe-master.min.js"></script>
    <script src="aframe-network-component.js"></script>
    <script>
      AFRAME.registerComponent("look-at", {schema: {type: "selector"}, init: function () {}, tick: function () {this.el.object3D.lookAt(this.data.object3D.position);}});
    </script>
  </head>
  <body>
    <audio id="audioOn" src="click_on.wav"></audio>
    <audio id="audioOff" src="click_off.wav"></audio>
    <a-scene background="color: #FFFFFF;">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 5;" position="0.0 1.6 0.0"></a-entity>
      <a-entity light="type: ambient;"></a-entity>
      <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="rightController" hand-controls="hand: right; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelColor: #7F7F7F;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelColor: #7F7F7F"></a-entity>
      <a-circle position="0.0 0.0 0.0" radius="1.500000" rotation="-90 0 0" color="#F0F0F0"></a-circle>
      <a-network position="0.0 0.0 0.0" rotation="0 0 0" node_size="0.020000" edge_opacity="0.2" src="url(cytokine.ply)"></a-network>
    </a-scene>
    <script>
      const node_names = ["CLCF1","IFNA2","PDGFD","CXCL12","CCL8","CXCL11","BMP4","CCL7","IL33","CCL4","CCL3","CCL27","EPO","CCL26","CCL5","CCL24","CD40LG","CCL21","CCL22","BMP6","CCL20","CCL2","IFNA","IFNL1","IL4","BMP2","TSLP","CCL23","TNFSF9","TNFSF13B","THPO","TNF","MSTN","HMGB1","CCL19","LTA","TGFB2","TGFB1","IL17A","TGFA","IL36RN","RETN","PPBP","PDGFB","INS","NO","IL18","PDGFA","GDF11","TNFSF10","OSM","MIF","LIF","IL25","IGF1","KITLG","Activin A","PGE2","IL9","CXCL8","IL7","IL21","CD40L","IL6","TNFSF11","IL37","IL32","IL13","CSF2","IL27","WNT3A","IL20","IL1B","FGF10","GDNF","IL1A","IL12","IL17F","CCL11","IL15","CCL1","IFNB","IL12A","IL11","BDNF","TGFB3","HGF","TNFSF12","GDF15","CSF3","FGF2","IL5","BMP7","FGF1","EGF","IL2","CXCL5","IL1RN","IL22","IL3","CXCL3","IL16","CXCL2","PF4","NRG1","CXCL13","IL10","CXCL10","IFNG","CXCL1","CCL18","IFNB1","VEGFA","IL12B","CX3CL1","CXCL9","CSF1","SPP1"];
      const node_positions = [0.892383, 1.5383909999999998, 1.056414, 1.892002, 0.007676, 0.09934799999999999, 1.368261, 1.000676, -0.229256, 1.853192, 0.001717, -0.0014520000000000088, -1.389469, 1.007598, -0.403235, -0.27736399999999994, 0.007427, 0.24377099999999996, 0.456647, 1.00315, -1.404414, -0.451179, 0.007817, 0.771184, 1.303534, 1.523428, -0.346521, -0.43231200000000003, 0.007749, 1.277977, -0.314389, 1.00504, 1.42824, -0.318438, 0.007072, 0.876558, 1.172134, 1.001165, -0.752998, 1.872387, 0.474024, 0.149285, -0.222326, 1.004698, -1.42023, -0.322314, 0.007538, 0.325782, 0.48366, 1.002612, -1.221079, -0.11051499999999992, 0.006936, 1.9275060000000002, -0.487729, 1.005374, -1.361839, 0.49073599999999995, 0.005016, 2.186442, 0.146342, 1.5069080000000001, 1.286899, 1.982863, 0.0013, 1.806553, -1.404354, 1.007521, 0.045958, 1.698372, 0.00248, -0.2700149999999999, -0.600277, 1.493883, 1.101715, 2.029649, 0.475314, 0.33941299999999996, 0.750302, 1.002479, 1.274553, 0.26773899999999995, 0.005569, -0.08115199999999989, -1.148839, 1.006516, 0.546193, 0.875724, 0.00431, 2.365925, 0.058092, 1.459508, -1.17206, -0.17410400000000004, 0.522011, 1.605029, 0.761203, 1.001881, -1.047626, 2.3204149999999997, 0.000829, 1.452661, -0.115617, 1.003924, -1.254789, 2.3649579999999997, 0.529712, 0.964173, 0.270892, 1.521067, 1.304727, 1.481907, 0.474609, 2.116492, 1.237927, 1.000703, 0.339314, 1.421561, 0.546657, 2.309891, -0.979429, 1.00618, -0.86519, 1.435895, 0.002711, 2.218271, -1.340662, 1.007178, -0.040663, -0.12595899999999993, 0.006885, 0.12514899999999995, -0.259634, 1.0, -1.429431, -0.1836500000000001, 0.006609, 1.473833, 1.296337, 1.5075319999999999, -0.17542, 2.438923, 0.000763, 0.6649970000000001, 1.157707, 1.000884, -0.552873, 0.515822, 0.005395, 2.357876, 0.669959, 1.455579, 0.958384, 0.603657, 0.005097, -0.371953, -0.796856, 1.005756, 1.032505, -0.33279900000000007, 0.007269, 1.347034, -0.075997, 1.502599, -1.279923, 1.2776100000000001, 0.494747, -0.23477900000000007, 1.110656, 1.5152290000000002, 0.72423, -0.27575799999999995, 0.006916, 0.7154929999999999, -0.906934, 1.005936, -0.909004, 2.237818, 0.481233, 1.080531, -1.467384, 1.007885, 0.165341, 1.253724, 0.003292, -0.3305020000000001, -0.849291, 1.460491, -0.800487, 2.1375070000000003, 0.000987, 0.36629500000000004, -0.77162, 1.00591, 1.141742, 0.20163299999999995, 0.470161, 1.8853490000000002, 0.651094, 1.5259230000000001, -1.181281, 2.3677200000000003, 0.000644, 0.858233, -0.343272, 1.488764, -1.195946, 0.959664, 0.004312, 2.441834, -0.722493, 1.00593, 1.229278, -0.09949300000000005, 0.006355, 1.610426, -0.318093, 1.510907, 1.261357, 2.154378, 0.001322, 0.15162699999999996, 0.064367, 1.003686, -1.328982, -0.07486199999999998, 0.00695, 2.019227, 0.166975, 1.003439, -1.321294, 1.988999, 0.001311, 0.17281500000000005, -1.13253, 1.006866, 0.830678, -0.352986, 0.007457, 1.444993, -0.279628, 1.003821, -1.247526, -0.06772899999999993, 0.006308, 1.684126, 0.046369, 1.003766, 1.32763, 1.414472, 0.003353, 2.437196, 0.638069, 1.002768, -1.355513, 1.006057, 0.515533, 2.315816, 0.604174, 1.002421, 1.191624, 2.455982, 0.00076, 1.3024200000000001, -1.12327, 1.006685, -0.764426, -0.28586500000000004, 0.511927, 1.145044, 1.193727, 1.001321, 0.834017, 2.3439579999999998, 0.000945, 1.5571570000000001, 0.199318, 1.014694, 1.254656, 0.426967, 0.005108, 2.132579, 1.03188, 1.518722, 0.845535, 0.7884720000000001, 0.004555, 2.365991, -0.672921, 1.005948, -1.326672, -0.2148460000000001, 0.006718, 0.562765, 0.49645, 1.002451, 1.15348, 2.33541, 0.537327, 1.365596, 0.900627, 1.491948, 0.887499, 2.107875, 0.460948, 0.572714, 1.165123, 1.001122, 0.709668, 2.240495, 0.000606, 1.177429, 0.709889, 1.002092, -1.11842, 0.856649, 0.46516, 2.177103, -1.154848, 1.4624920000000001, -0.182309, 0.16731200000000002, 0.005687, 0.05303599999999997, 0.36764, 1.00337, -1.43139, 2.083, 0.471645, 1.549471, -0.55862, 1.00545, -1.29735, 0.33769499999999997, 0.005394, -0.1242700000000001, 1.257947, 1.000729, -0.377405, 0.961455, 0.003936, -0.32910400000000006, -0.788725, 1.00566, -1.019843, -0.2944389999999999, 0.007257, 0.439705, -0.398369, 1.005191, 1.387524, 1.8295810000000001, 0.497463, 0.02794399999999997];
      function toggle_label(index, labels, positions) {
        var existing = document.getElementById("label"+index);
        if (existing) {
          document.getElementById("audioOff").play();
          existing.parentElement.removeChild(existing);
        }
        else {
          document.getElementById("audioOn").play();
          var entity = document.createElement("a-entity");
          entity.setAttribute("id", "label"+index);
          entity.setAttribute("look-at", "#camera");
          entity.setAttribute("position", {x: positions[index*3], y: positions[index*3+1], z: positions[index*3+2]});
          entity.setAttribute("scale", {x: 0.200000, y: 0.200000, z: 0.200000});
          entity.setAttribute("text", {anchor: "left", baseline: "bottom", color: "#000000", value: labels[index]});
          document.querySelector("a-scene").appendChild(entity);
        }
      }
      function find_nearest(position, positions) {
        var nearest_d = 1000.0;
        var nearest_i = null;
        for (let i = 0; i < node_positions.length; i += 3) {
          let d = Math.sqrt((position.x-positions[i])**2+(position.y-positions[i+1])**2+(position.z-positions[i+2])**2);
          if (d < nearest_d) {
            nearest_d = d;
            nearest_i = i/3;
          }
        }
        if (nearest_d < 0.1) {
          toggle_label(nearest_i, node_names, positions);
        }
      }
      document.getElementById("leftController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("leftController").getAttribute("position"), node_positions);
      });
      document.getElementById("rightController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("rightController").getAttribute("position"), node_positions);
      });
      document.getElementById("leftHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
      document.getElementById("rightHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
    </script>
  </body>
</html>
