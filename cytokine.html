<!DOCTYPE html>
<html>
  <head>
    <script src="aframe-master.min.js"></script>
    <script src="aframe-network-component.js"></script>
    <script>
      AFRAME.registerComponent("look-at", {schema: {type: "selector"}, init: function () {}, tick: function () {this.el.object3D.lookAt(this.data.object3D.position);}});
    </script>
  </head>
  <body>
    <audio id="audioOn" src="click_on.wav"></audio>
    <audio id="audioOff" src="click_off.wav"></audio>
    <a-scene background="color: #FFFFFF;">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 5;" position="0.0 1.6 0.0"></a-entity>
      <a-entity light="type: ambient;"></a-entity>
      <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="rightController" hand-controls="hand: right; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelColor: #7F7F7F;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelColor: #7F7F7F"></a-entity>
      <a-circle position="0.0 0.0 0.0" radius="1.500000" rotation="-90 0 0" color="#F0F0F0"></a-circle>
      <a-network position="0.0 0.0 0.0" rotation="0 0 0" node_size="0.020000" edge_opacity="0.2" src="url(cytokine.ply)"></a-network>
    </a-scene>
    <script>
      const node_names = ["CLCF1","IFNA2","PDGFD","CXCL12","CCL8","CXCL11","BMP4","CCL7","IL33","CCL4","CCL3","CCL27","EPO","CCL26","CCL5","CCL24","CD40LG","CCL21","CCL22","BMP6","CCL20","CCL2","IFNA","IFNL1","IL4","BMP2","TSLP","CCL23","TNFSF9","TNFSF13B","THPO","TNF","MSTN","HMGB1","CCL19","LTA","TGFB2","TGFB1","IL17A","TGFA","IL36RN","RETN","PPBP","PDGFB","INS","NO","IL18","PDGFA","GDF11","TNFSF10","OSM","MIF","LIF","IL25","IGF1","KITLG","Activin A","PGE2","IL9","CXCL8","IL7","IL21","CD40L","IL6","TNFSF11","IL37","IL32","IL13","CSF2","IL27","WNT3A","IL20","IL1B","FGF10","GDNF","IL1A","IL12","IL17F","CCL11","IL15","CCL1","IFNB","IL12A","IL11","BDNF","TGFB3","HGF","TNFSF12","GDF15","CSF3","FGF2","IL5","BMP7","FGF1","EGF","IL2","CXCL5","IL1RN","IL22","IL3","CXCL3","IL16","CXCL2","PF4","NRG1","CXCL13","IL10","CXCL10","IFNG","CXCL1","CCL18","IFNB1","VEGFA","IL12B","CX3CL1","CXCL9","CSF1","SPP1"];
      const node_positions = [0.892383,0.538391,1.056414,0.892002,0.007676,-0.900652,1.368261,0.000676,-0.229256,0.853192,0.001717,-1.001452,-1.389469,0.007598,-0.403235,-1.277364,0.007427,-0.756229,0.456647,0.003150,-1.404414,-1.451179,0.007817,-0.228816,1.303534,0.523428,-0.346521,-1.432312,0.007749,0.277977,-0.314389,0.005040,1.428240,-1.318438,0.007072,-0.123442,1.172134,0.001165,-0.752998,0.872387,0.474024,-0.850715,-0.222326,0.004698,-1.420230,-1.322314,0.007538,-0.674218,0.483660,0.002612,-1.221079,-1.110515,0.006936,0.927506,-0.487729,0.005374,-1.361839,-0.509264,0.005016,1.186442,0.146342,0.506908,1.286899,0.982863,0.001300,0.806553,-1.404354,0.007521,0.045958,0.698372,0.002480,-1.270015,-0.600277,0.493883,1.101715,1.029649,0.475314,-0.660587,0.750302,0.002479,1.274553,-0.732261,0.005569,-1.081152,-1.148839,0.006516,0.546193,-0.124276,0.004310,1.365925,0.058092,0.459508,-1.172060,-1.174104,0.522011,0.605029,0.761203,0.001881,-1.047626,1.320415,0.000829,0.452661,-0.115617,0.003924,-1.254789,1.364958,0.529712,-0.035827,0.270892,0.521067,1.304727,0.481907,0.474609,1.116492,1.237927,0.000703,0.339314,0.421561,0.546657,1.309891,-0.979429,0.006180,-0.865190,0.435895,0.002711,1.218271,-1.340662,0.007178,-0.040663,-1.125959,0.006885,-0.874851,-0.259634,0.000000,-1.429431,-1.183650,0.006609,0.473833,1.296337,0.507532,-0.175420,1.438923,0.000763,-0.335003,1.157707,0.000884,-0.552873,-0.484178,0.005395,1.357876,0.669959,0.455579,0.958384,-0.396343,0.005097,-1.371953,-0.796856,0.005756,1.032505,-1.332799,0.007269,0.347034,-0.075997,0.502599,-1.279923,0.277610,0.494747,-1.234779,1.110656,0.515229,0.724230,-1.275758,0.006916,-0.284507,-0.906934,0.005936,-0.909004,1.237818,0.481233,0.080531,-1.467384,0.007885,0.165341,0.253724,0.003292,-1.330502,-0.849291,0.460491,-0.800487,1.137507,0.000987,-0.633705,-0.771620,0.005910,1.141742,-0.798367,0.470161,0.885349,0.651094,0.525923,-1.181281,1.367720,0.000644,-0.141767,-0.343272,0.488764,-1.195946,-0.040336,0.004312,1.441834,-0.722493,0.005930,1.229278,-1.099493,0.006355,0.610426,-0.318093,0.510907,1.261357,1.154378,0.001322,-0.848373,0.064367,0.003686,-1.328982,-1.074862,0.006950,1.019227,0.166975,0.003439,-1.321294,0.988999,0.001311,-0.827185,-1.132530,0.006866,0.830678,-1.352986,0.007457,0.444993,-0.279628,0.003821,-1.247526,-1.067729,0.006308,0.684126,0.046369,0.003766,1.327630,0.414472,0.003353,1.437196,0.638069,0.002768,-1.355513,0.006057,0.515533,1.315816,0.604174,0.002421,1.191624,1.455982,0.000760,0.302420,-1.123270,0.006685,-0.764426,-1.285865,0.511927,0.145044,1.193727,0.001321,0.834017,1.343958,0.000945,0.557157,0.199318,0.014694,1.254656,-0.573033,0.005108,1.132579,1.031880,0.518722,0.845535,-0.211528,0.004555,1.365991,-0.672921,0.005948,-1.326672,-1.214846,0.006718,-0.437235,0.496450,0.002451,1.153480,1.335410,0.537327,0.365596,0.900627,0.491948,0.887499,1.107875,0.460948,-0.427286,1.165123,0.001122,0.709668,1.240495,0.000606,0.177429,0.709889,0.002092,-1.118420,-0.143351,0.465160,1.177103,-1.154848,0.462492,-0.182309,-0.832688,0.005687,-0.946964,0.367640,0.003370,-1.431390,1.083000,0.471645,0.549471,-0.558620,0.005450,-1.297350,-0.662305,0.005394,-1.124270,1.257947,0.000729,-0.377405,-0.038545,0.003936,-1.329104,-0.788725,0.005660,-1.019843,-1.294439,0.007257,-0.560295,-0.398369,0.005191,1.387524,0.829581,0.497463,-0.972056];
      function toggle_label(index, labels, positions) {
        var existing = document.getElementById("label"+index);
        if (existing) {
          document.getElementById("audioOff").play();
          existing.parentElement.removeChild(existing);
        }
        else {
          document.getElementById("audioOn").play();
          var entity = document.createElement("a-entity");
          entity.setAttribute("id", "label"+index);
          entity.setAttribute("look-at", "#camera");
          entity.setAttribute("position", {x: positions[index*3], y: positions[index*3+1], z: positions[index*3+2]});
          entity.setAttribute("scale", {x: 0.200000, y: 0.200000, z: 0.200000});
          entity.setAttribute("text", {anchor: "left", baseline: "bottom", color: "#000000", value: labels[index]});
          document.querySelector("a-scene").appendChild(entity);
        }
      }
      function find_nearest(position, positions) {
        var nearest_d = 1000.0;
        var nearest_i = null;
        for (let i = 0; i < node_positions.length; i += 3) {
          let d = Math.sqrt((position.x-positions[i])**2+(position.y-positions[i+1])**2+(position.z-positions[i+2])**2);
          if (d < nearest_d) {
            nearest_d = d;
            nearest_i = i/3;
          }
        }
        if (nearest_d < 0.1) {
          toggle_label(nearest_i, node_names, positions);
        }
      }
      document.getElementById("leftController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("leftController").getAttribute("position"), node_positions);
      });
      document.getElementById("rightController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("rightController").getAttribute("position"), node_positions);
      });
      document.getElementById("leftHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
      document.getElementById("rightHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
    </script>
  </body>
</html>
