<!DOCTYPE html>
<html>
  <head>
    <script src="aframe-master.min.js"></script>
    <script src="aframe-network-component.js"></script>
    <script>
      AFRAME.registerComponent("look-at", {schema: {type: "selector"}, init: function () {}, tick: function () {this.el.object3D.lookAt(this.data.object3D.position);}});
    </script>
  </head>
  <body>
    <audio id="audioOn" src="click_on.wav"></audio>
    <audio id="audioOff" src="click_off.wav"></audio>
    <a-scene background="color: #FFFFFF;">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 5;" position="0.0 1.6 0.0"></a-entity>
      <a-entity light="type: ambient;"></a-entity>
      <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="rightController" hand-controls="hand: right; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelColor: #7F7F7F;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelColor: #7F7F7F"></a-entity>
      <a-circle position="0.0 0.0 0.0" radius="2.200000" rotation="-90 0 0" color="#F0F0F0"></a-circle>
      <a-network position="0.0 0.0 0.0" rotation="0 0 0" node_size="0.020000" edge_opacity="0.2" src="url(cytokine.ply)"></a-network>
    </a-scene>
    <script>
      const node_names = ["CLCF1","IFNA2","PDGFD","CXCL12","CCL8","CXCL11","BMP4","CCL7","IL33","CCL4","CCL3","CCL27","EPO","CCL26","CCL5","CCL24","CD40LG","CCL21","CCL22","BMP6","CCL20","CCL2","IFNA","IFNL1","IL4","BMP2","TSLP","CCL23","TNFSF9","TNFSF13B","THPO","TNF","MSTN","HMGB1","CCL19","LTA","TGFB2","TGFB1","IL17A","TGFA","IL36RN","RETN","PPBP","PDGFB","INS","NO","IL18","PDGFA","GDF11","TNFSF10","OSM","MIF","LIF","IL25","IGF1","KITLG","Activin A","PGE2","IL9","CXCL8","IL7","IL21","CD40L","IL6","TNFSF11","IL37","IL32","IL13","CSF2","IL27","WNT3A","IL20","IL1B","FGF10","GDNF","IL1A","IL12","IL17F","CCL11","IL15","CCL1","IFNB","IL12A","IL11","BDNF","TGFB3","HGF","TNFSF12","GDF15","CSF3","FGF2","IL5","BMP7","FGF1","EGF","IL2","CXCL5","IL1RN","IL22","IL3","CXCL3","IL16","CXCL2","PF4","NRG1","CXCL13","IL10","CXCL10","IFNG","CXCL1","CCL18","IFNB1","VEGFA","IL12B","CX3CL1","CXCL9","CSF1","SPP1"];
      const node_positions = [1.321191,-0.051924,1.564042,1.400202,-0.816049,-1.413781,1.938546,-0.817949,-0.324809,1.226410,-0.785291,-1.439524,-1.775103,-0.759637,-0.515149,-1.708220,-0.816389,-1.011306,0.562582,-0.753873,-1.730216,-1.818897,-0.756634,-0.286796,2.081937,-0.057162,-0.553446,-1.978098,-0.828004,0.383901,-0.398314,-0.765095,1.809500,-1.849177,-0.763125,-0.173133,1.569765,-0.775716,-1.008442,1.514841,-0.054268,-1.477209,-0.302428,-0.807855,-1.931928,-1.665549,-0.768705,-0.849226,0.742993,-0.836320,-1.875806,-1.427611,-0.765367,1.192346,-0.669218,-0.819024,-1.868595,-0.777916,-0.813467,1.812326,0.243558,-0.050550,2.141800,1.527268,-0.821012,1.253301,-1.864439,-0.766460,0.061014,0.872653,-0.751252,-1.586951,-1.010975,-0.045085,1.855488,1.728769,-0.053597,-1.109118,1.015032,-0.830050,1.724257,-1.102370,-0.810002,-1.627602,-1.817636,-0.827427,0.864160,-0.166857,-0.761029,1.833932,0.102641,-0.048248,-2.070874,-1.818854,-0.040672,0.937276,1.068248,-0.754358,-1.470205,1.762449,-0.775108,0.604198,-0.185347,-0.834894,-2.011568,2.179745,-0.058106,-0.057213,0.439071,-0.051349,2.114747,0.804088,-0.049644,1.862929,1.936075,-0.835262,0.530675,0.611326,-0.035864,1.899537,-1.518893,-0.834060,-1.341731,0.672235,-0.826912,1.878812,-1.915187,-0.787265,-0.058088,-1.436052,-0.748237,-1.115787,-0.337725,-0.787411,-1.859364,-1.829863,-0.810208,0.732521,2.076914,-0.055790,-0.281048,1.871764,-0.799683,-0.435775,1.649842,-0.760437,-0.787897,-0.651871,-0.800851,1.828171,1.118308,-0.048994,1.599753,-0.552466,-0.821717,-1.912378,-1.107652,-0.746728,1.435210,-1.793051,-0.761431,0.466874,-0.130308,-0.050302,-2.194605,0.478005,-0.052032,-2.126116,1.812806,-0.056387,1.182084,-1.896239,-0.798384,-0.422881,-1.372308,-0.799842,-1.375440,2.100721,-0.056081,0.136670,-1.932306,-0.798986,0.217727,0.379362,-0.838496,-1.989335,-1.518768,-0.042745,-1.431492,1.637929,-0.779690,-0.912489,-1.062156,-0.781568,1.571638,-1.417299,-0.043714,1.571714,1.016320,-0.052252,-1.843911,1.872767,-0.783546,-0.194116,-0.542588,-0.043472,-1.890355,-0.051550,-0.762113,1.842667,-0.918525,-0.747153,1.562815,-1.727480,-0.812469,0.959076,-0.521134,-0.047252,2.066490,1.490292,-0.768763,-1.095243,0.089350,-0.764031,-1.844810,-1.457368,-0.826633,1.381935,0.228136,-0.753088,-1.805263,1.465559,-0.793978,-1.225773,-1.579966,-0.806050,1.158860,-1.875246,-0.811343,0.616762,-0.421178,-0.796126,-1.879033,-1.673808,-0.817594,1.072459,0.069661,-0.825421,1.994499,0.504184,-0.753719,1.748276,0.773557,-0.753160,-1.643344,0.009364,-0.046916,2.034276,0.870477,-0.798275,1.716859,1.890935,-0.803637,0.392764,-1.610234,-0.801186,-1.095823,-2.012237,-0.039508,0.226977,1.484639,-0.752845,1.037268,1.720576,-0.774760,0.713289,0.297973,-0.767580,1.875658,-0.831341,-0.759251,1.643115,1.620003,-0.054084,1.327449,-0.284554,-0.768146,1.837568,-0.829051,-0.755701,-1.634483,-1.788973,-0.781508,-0.643869,0.802552,-0.841571,1.864694,2.109725,-0.057999,0.577581,1.473244,-0.052955,1.451770,1.819608,-0.051520,-0.701788,1.612928,-0.785222,0.982423,1.824985,-0.767184,0.261029,1.005121,-0.778296,-1.583554,-0.243459,-0.045541,1.999117,-2.124589,-0.042024,-0.335397,-1.289113,-0.803884,-1.466028,0.483793,-0.805516,-1.883628,1.821326,-0.053613,0.924068,-0.770930,-0.804084,-1.790421,-0.932288,-0.757098,-1.582570,1.891457,-0.821624,-0.567468,-0.055349,-0.789445,-1.908553,-1.205664,-0.811794,-1.558958,-1.800606,-0.806594,-0.779389,-0.511911,-0.765706,1.782993,1.365547,-0.053452,-1.600071];
      function toggle_label(index, labels, positions) {
        var existing = document.getElementById("label"+index);
        if (existing) {
          document.getElementById("audioOff").play();
          existing.parentElement.removeChild(existing);
        }
        else {
          document.getElementById("audioOn").play();
          var entity = document.createElement("a-entity");
          entity.setAttribute("id", "label"+index);
          entity.setAttribute("look-at", "#camera");
          entity.setAttribute("position", {x: positions[index*3], y: positions[index*3+1], z: positions[index*3+2]});
          entity.setAttribute("scale", {x: 0.200000, y: 0.200000, z: 0.200000});
          entity.setAttribute("text", {anchor: "left", baseline: "bottom", color: "#000000", value: labels[index]});
          document.querySelector("a-scene").appendChild(entity);
        }
      }
      function find_nearest(position, positions) {
        var nearest_d = 1000.0;
        var nearest_i = null;
        for (let i = 0; i < node_positions.length; i += 3) {
          let d = Math.sqrt((position.x-positions[i])**2+(position.y-positions[i+1])**2+(position.z-positions[i+2])**2);
          if (d < nearest_d) {
            nearest_d = d;
            nearest_i = i/3;
          }
        }
        if (nearest_d < 0.1) {
          toggle_label(nearest_i, node_names, positions);
        }
      }
      document.getElementById("leftController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("leftController").getAttribute("position"), node_positions);
      });
      document.getElementById("rightController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("rightController").getAttribute("position"), node_positions);
      });
      document.getElementById("leftHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
      document.getElementById("rightHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
    </script>
  </body>
</html>
