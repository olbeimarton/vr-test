<!DOCTYPE html>
<html>
  <head>
    <script src="aframe-master.min.js"></script>
    <script src="aframe-network-component.js"></script>
    <script>
      AFRAME.registerComponent("look-at", {schema: {type: "selector"}, init: function () {}, tick: function () {this.el.object3D.lookAt(this.data.object3D.position);}});
    </script>
  </head>
  <body>
    <audio id="audioOn" src="click_on.wav"></audio>
    <audio id="audioOff" src="click_off.wav"></audio>
    <a-scene background="color: #FFFFFF;">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 5;" position="0.0 1.6 0.0"></a-entity>
      <a-entity light="type: ambient;"></a-entity>
      <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="rightController" hand-controls="hand: right; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelColor: #7F7F7F;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelColor: #7F7F7F"></a-entity>
      <a-circle position="0.0 0.0 0.0" radius="2.200000" rotation="-90 0 0" color="#F0F0F0"></a-circle>
      <a-network position="0.0 0.0 0.0" rotation="0 0 0" node_size="0.020000" edge_opacity="0.2" src="url(cytokine.ply)"></a-network>
    </a-scene>
    <script>
      const node_names = ["CLCF1","IFNA2","PDGFD","CXCL12","CCL8","CXCL11","BMP4","CCL7","IL33","CCL4","CCL3","CCL27","EPO","CCL26","CCL5","CCL24","CD40LG","CCL21","CCL22","BMP6","CCL20","CCL2","IFNA","IFNL1","IL4","BMP2","TSLP","CCL23","TNFSF9","TNFSF13B","THPO","TNF","MSTN","HMGB1","CCL19","LTA","TGFB2","TGFB1","IL17A","TGFA","IL36RN","RETN","PPBP","PDGFB","INS","NO","IL18","PDGFA","GDF11","TNFSF10","OSM","MIF","LIF","IL25","IGF1","KITLG","Activin A","PGE2","IL9","CXCL8","IL7","IL21","CD40L","IL6","TNFSF11","IL37","IL32","IL13","CSF2","IL27","WNT3A","IL20","IL1B","FGF10","GDNF","IL1A","IL12","IL17F","CCL11","IL15","CCL1","IFNB","IL12A","IL11","BDNF","TGFB3","HGF","TNFSF12","GDF15","CSF3","FGF2","IL5","BMP7","FGF1","EGF","IL2","CXCL5","IL1RN","IL22","IL3","CXCL3","IL16","CXCL2","PF4","NRG1","CXCL13","IL10","CXCL10","IFNG","CXCL1","CCL18","IFNB1","VEGFA","IL12B","CX3CL1","CXCL9","CSF1","SPP1"];
      const node_positions = [1.317457,0.794846,1.559622,1.414329,0.012171,-1.428045,1.967141,0.000973,-0.329600,1.316604,0.002649,-1.545391,-1.942593,0.010623,-0.563756,-1.815620,0.010557,-1.074889,0.633579,0.004370,-1.948568,-2.004900,0.010799,-0.316124,1.763886,0.708280,-0.468898,-1.971030,0.010664,0.382530,-0.462540,0.007416,2.101274,-2.141124,0.011486,-0.200468,1.728665,0.001719,-1.110523,1.350785,0.733969,-1.317229,-0.302217,0.006386,-1.930578,-1.859457,0.010600,-0.948096,0.787299,0.004251,-1.987665,-1.543823,0.009643,1.289407,-0.714228,0.007870,-1.994270,-0.845457,0.008327,1.969679,0.210651,0.729665,1.852417,1.605849,0.002124,1.317786,-2.096706,0.011228,0.068615,1.029843,0.003657,-1.872807,-0.950417,0.781964,1.744342,1.597465,0.737434,-1.024878,0.993940,0.003285,1.688427,-1.132220,0.008610,-1.671673,-1.809065,0.010261,0.860085,-0.185645,0.006438,2.040441,0.096522,0.763491,-1.947427,-1.704966,0.758034,0.878588,1.254666,0.003101,-1.726767,1.914186,0.001202,0.656216,-0.200592,0.006807,-2.177023,1.953296,0.758034,-0.051269,0.413806,0.795964,1.993058,0.782165,0.770321,1.812138,1.921306,0.001091,0.526627,0.593440,0.769540,1.843961,-1.598108,0.010084,-1.411707,0.679735,0.004227,1.899772,-2.186589,0.011707,-0.066320,-1.582103,0.009674,-1.229267,-0.357404,0.000000,-1.967706,-1.971473,0.011008,0.789210,1.995602,0.781303,-0.270044,2.063185,0.001095,-0.480340,1.932224,0.001475,-0.922751,-0.697041,0.007766,1.954850,1.132238,0.769933,1.619679,-0.570062,0.007331,-1.973288,-1.306054,0.009434,1.692284,-1.994096,0.010876,0.519222,-0.119500,0.790300,-2.012585,0.448370,0.799071,-1.994304,1.554337,0.721051,1.013543,-2.039296,0.011055,-0.454784,-1.415559,0.009265,-1.418790,1.922912,0.747581,0.125102,-2.185118,0.011741,0.246213,0.394941,0.005125,-2.071030,-1.423225,0.771681,-1.341440,1.764374,0.001532,-0.982932,-1.121151,0.008587,1.658932,-1.355510,0.798264,1.503193,0.988266,0.798273,-1.793012,2.032541,0.000956,-0.210676,-0.524086,0.746214,-1.825897,-0.061383,0.006561,2.194136,-1.105164,0.009071,1.880369,-1.786863,0.010327,0.992045,-0.447677,0.719040,1.775207,1.713693,0.001962,-1.259424,0.103075,0.005903,-2.128174,-1.583493,0.010239,1.501532,0.253168,0.005214,-2.003348,1.559864,0.002067,-1.304649,-1.618715,0.009813,1.187282,-1.977157,0.010897,0.650281,-0.426813,0.005832,-1.904172,-1.779829,0.010516,1.140390,0.073446,0.005966,2.102863,0.550141,0.004451,1.907633,0.874818,0.003795,-1.858463,0.008458,0.719947,1.837550,0.984723,0.003945,1.942187,2.051428,0.001071,0.426099,-1.677115,0.009981,-1.141338,-1.985436,0.790439,0.223954,1.645548,0.001821,1.149690,2.015241,0.001416,0.835447,0.335260,0.024716,2.110374,-0.993139,0.008853,1.962904,1.408897,0.708246,1.154467,-0.329627,0.007098,2.128642,-0.960228,0.008487,-1.893100,-2.019469,0.011167,-0.726827,0.778739,0.003844,1.809367,1.848470,0.743767,0.506057,1.301686,0.711018,1.282712,1.903237,0.791870,-0.734042,1.685935,0.001623,1.026890,2.075049,0.001013,0.296796,1.154016,0.003401,-1.818135,-0.247540,0.803239,2.032625,-1.907012,0.763718,-0.301049,-1.370520,0.009360,-1.558607,0.524393,0.004807,-2.041703,1.715638,0.747158,0.870447,-0.805460,0.007858,-1.870615,-1.064702,0.008671,-1.807345,1.879473,0.001090,-0.563873,-0.061899,0.006320,-2.134420,-1.333800,0.009571,-1.724641,-2.014369,0.011294,-0.871916,-0.569945,0.007426,1.985126,1.192981,0.715378,-1.397868];
      function toggle_label(index, labels, positions) {
        var existing = document.getElementById("label"+index);
        if (existing) {
          document.getElementById("audioOff").play();
          existing.parentElement.removeChild(existing);
        }
        else {
          document.getElementById("audioOn").play();
          var entity = document.createElement("a-entity");
          entity.setAttribute("id", "label"+index);
          entity.setAttribute("look-at", "#camera");
          entity.setAttribute("position", {x: positions[index*3], y: positions[index*3+1], z: positions[index*3+2]});
          entity.setAttribute("scale", {x: 0.200000, y: 0.200000, z: 0.200000});
          entity.setAttribute("text", {anchor: "left", baseline: "bottom", color: "#000000", value: labels[index]});
          document.querySelector("a-scene").appendChild(entity);
        }
      }
      function find_nearest(position, positions) {
        var nearest_d = 1000.0;
        var nearest_i = null;
        for (let i = 0; i < node_positions.length; i += 3) {
          let d = Math.sqrt((position.x-positions[i])**2+(position.y-positions[i+1])**2+(position.z-positions[i+2])**2);
          if (d < nearest_d) {
            nearest_d = d;
            nearest_i = i/3;
          }
        }
        if (nearest_d < 0.1) {
          toggle_label(nearest_i, node_names, positions);
        }
      }
      document.getElementById("leftController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("leftController").getAttribute("position"), node_positions);
      });
      document.getElementById("rightController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("rightController").getAttribute("position"), node_positions);
      });
      document.getElementById("leftHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
      document.getElementById("rightHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
    </script>
  </body>
</html>
