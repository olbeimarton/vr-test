<!DOCTYPE html>
<html>
  <head>
    <script src="aframe-master.min.js"></script>
    <script src="aframe-network-component.js"></script>
    <script>
      AFRAME.registerComponent("look-at", {schema: {type: "selector"}, init: function () {}, tick: function () {this.el.object3D.lookAt(this.data.object3D.position);}});
    </script>
  </head>
  <body>
    <audio id="audioOn" src="click_on.wav"></audio>
    <audio id="audioOff" src="click_off.wav"></audio>
    <a-scene background="color: #FFFFFF;">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 5;" position="0.0 1.6 0.0"></a-entity>
      <a-entity light="type: ambient;"></a-entity>
      <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="rightController" hand-controls="hand: right; handModelStyle: highPoly; color: #7F7F7F"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelColor: #7F7F7F;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelColor: #7F7F7F"></a-entity>
      <a-circle position="0.0 0.0 0.0" radius="2.200000" rotation="-90 0 0" color="#F0F0F0"></a-circle>
      <a-network position="0.0 0.0 0.0" rotation="0 0 0" node_size="0.020000" edge_opacity="0.2" src="url(cytokine.ply)"></a-network>
    </a-scene>
    <script>
      const node_names = ["CLCF1","IFNA2","PDGFD","CXCL12","CCL8","CXCL11","BMP4","CCL7","IL33","CCL4","CCL3","CCL27","EPO","CCL26","CCL5","CCL24","CD40LG","CCL21","CCL22","BMP6","CCL20","CCL2","IFNA","IFNL1","IL4","BMP2","TSLP","CCL23","TNFSF9","TNFSF13B","THPO","TNF","MSTN","HMGB1","CCL19","LTA","TGFB2","TGFB1","IL17A","TGFA","IL36RN","RETN","PPBP","PDGFB","INS","NO","IL18","PDGFA","GDF11","TNFSF10","OSM","MIF","LIF","IL25","IGF1","KITLG","Activin A","PGE2","IL9","CXCL8","IL7","IL21","CD40L","IL6","TNFSF11","IL37","IL32","IL13","CSF2","IL27","WNT3A","IL20","IL1B","FGF10","GDNF","IL1A","IL12","IL17F","CCL11","IL15","CCL1","IFNB","IL12A","IL11","BDNF","TGFB3","HGF","TNFSF12","GDF15","CSF3","FGF2","IL5","BMP7","FGF1","EGF","IL2","CXCL5","IL1RN","IL22","IL3","CXCL3","IL16","CXCL2","PF4","NRG1","CXCL13","IL10","CXCL10","IFNG","CXCL1","CCL18","IFNB1","VEGFA","IL12B","CX3CL1","CXCL9","CSF1","SPP1"];
      const node_positions = [1.336825,-0.659141,1.582550,1.213183,-1.280003,-1.224948,1.708358,-1.298074,-0.286240,1.032467,-1.191446,-1.211880,-1.507368,-1.166884,-0.437450,-1.382321,-1.194771,-0.818366,0.505911,-1.222722,-1.555926,-1.693236,-1.274234,-0.266982,1.983446,-0.655534,-0.527264,-1.701238,-1.288249,0.330169,-0.362928,-1.258898,1.648747,-1.629698,-1.216709,-0.152584,1.339316,-1.192239,-0.860398,1.469884,-0.653861,-1.433370,-0.267515,-1.290225,-1.708899,-1.441767,-1.203515,-0.735125,0.599318,-1.216541,-1.513075,-1.292349,-1.252781,1.079374,-0.579730,-1.281579,-1.618726,-0.669706,-1.265178,1.560228,0.230257,-0.644327,2.024833,1.324225,-1.282579,1.086681,-1.596068,-1.187025,0.052232,0.845801,-1.312747,-1.538120,-0.972830,-0.638374,1.785478,1.682570,-0.637602,-1.079479,0.887073,-1.307790,1.506889,-0.891979,-1.184487,-1.316968,-1.563888,-1.287657,0.743521,-0.151502,-1.247472,1.665167,0.100704,-0.642807,-2.031803,-1.776348,-0.624337,0.915372,1.002550,-1.276069,-1.379786,1.540665,-1.220303,0.528166,-0.155841,-1.267278,-1.691345,1.982003,-0.633525,-0.052023,0.378413,-0.589179,1.822593,0.761140,-0.609316,1.763428,1.509034,-1.172450,0.413624,0.597884,-0.605848,1.857772,-1.206784,-1.198144,-1.066026,0.557026,-1.235774,1.556817,-1.654905,-1.230692,-0.050194,-1.363135,-1.284275,-1.059132,-0.283393,-1.189325,-1.560238,-1.598316,-1.280081,0.639830,1.911020,-0.616133,-0.258599,1.668402,-1.283660,-0.388429,1.525477,-1.266422,-0.728505,-0.554920,-1.231467,1.556274,1.182895,-0.656349,1.692144,-0.458916,-1.232764,-1.588551,-1.034109,-1.260097,1.339919,-1.562790,-1.200536,0.406919,-0.111988,-0.596248,-1.886070,0.408517,-0.589676,-1.817041,1.714064,-0.652571,1.117696,-1.583276,-1.205916,-0.353087,-1.155455,-1.217505,-1.158092,1.985223,-0.635659,0.129156,-1.575102,-1.178239,0.177478,0.319973,-1.275918,-1.677903,-1.399099,-0.601897,-1.318700,1.524357,-1.307055,-0.849218,-0.942158,-1.252937,1.394081,-1.293576,-0.605071,1.434512,0.913065,-0.600768,-1.656575,1.702220,-1.282504,-0.176438,-0.525384,-0.599411,-1.830416,-0.048780,-1.301736,1.743648,-0.875666,-1.287153,1.489891,-1.377993,-1.172151,0.765045,-0.456662,-0.587962,1.810836,1.375381,-1.278178,-1.010792,0.084771,-1.308171,-1.750261,-1.140934,-1.170031,1.081879,0.217388,-1.294832,-1.720218,1.343769,-1.311643,-1.123910,-1.267647,-1.169466,0.929783,-1.507176,-1.179584,0.495705,-0.353458,-1.205996,-1.576909,-1.343622,-1.186916,0.860899,0.055110,-1.178541,1.577881,0.445196,-1.200484,1.543731,0.739360,-1.298001,-1.570696,0.009615,-0.659550,2.088697,0.708610,-1.171689,1.397606,1.634488,-1.250964,0.339497,-1.375217,-1.237381,-0.935885,-2.036967,-0.639657,0.229767,1.312865,-1.199349,0.917255,1.612136,-1.307469,0.668334,0.267814,-1.255624,1.685817,-0.766931,-1.265553,1.515812,1.536625,-0.633059,1.259128,-0.251904,-1.227812,1.626726,-0.759801,-1.251342,-1.497957,-1.631941,-1.289552,-0.587352,0.621936,-1.176063,1.445042,1.872064,-0.619920,0.512516,1.431724,-0.640067,1.410855,1.836072,-0.628323,-0.708138,1.451324,-1.272764,0.883990,1.656021,-1.253645,0.236862,0.893667,-1.247431,-1.407959,-0.239797,-0.625422,1.969048,-1.884660,-0.595437,-0.297521,-1.098029,-1.237754,-1.248720,0.429911,-1.291202,-1.673839,1.707337,-0.610944,0.866235,-0.697207,-1.313705,-1.619205,-0.892664,-1.309944,-1.515307,1.549134,-1.211891,-0.464766,-0.046275,-1.191358,-1.595674,-1.045799,-1.272730,-1.352248,-1.439613,-1.166442,-0.623134,-0.463578,-1.252369,1.614650,1.254292,-0.614875,-1.469708];
      function toggle_label(index, labels, positions) {
        var existing = document.getElementById("label"+index);
        if (existing) {
          document.getElementById("audioOff").play();
          existing.parentElement.removeChild(existing);
        }
        else {
          document.getElementById("audioOn").play();
          var entity = document.createElement("a-entity");
          entity.setAttribute("id", "label"+index);
          entity.setAttribute("look-at", "#camera");
          entity.setAttribute("position", {x: positions[index*3], y: positions[index*3+1], z: positions[index*3+2]});
          entity.setAttribute("scale", {x: 0.200000, y: 0.200000, z: 0.200000});
          entity.setAttribute("text", {anchor: "left", baseline: "bottom", color: "#000000", value: labels[index]});
          document.querySelector("a-scene").appendChild(entity);
        }
      }
      function find_nearest(position, positions) {
        var nearest_d = 1000.0;
        var nearest_i = null;
        for (let i = 0; i < node_positions.length; i += 3) {
          let d = Math.sqrt((position.x-positions[i])**2+(position.y-positions[i+1])**2+(position.z-positions[i+2])**2);
          if (d < nearest_d) {
            nearest_d = d;
            nearest_i = i/3;
          }
        }
        if (nearest_d < 0.1) {
          toggle_label(nearest_i, node_names, positions);
        }
      }
      document.getElementById("leftController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("leftController").getAttribute("position"), node_positions);
      });
      document.getElementById("rightController").addEventListener("gripdown", function (event) {
        find_nearest(document.getElementById("rightController").getAttribute("position"), node_positions);
      });
      document.getElementById("leftHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
      document.getElementById("rightHand").addEventListener("pinchstarted", function (event) {
        find_nearest(event.detail.position, node_positions);
      });
    </script>
  </body>
</html>
